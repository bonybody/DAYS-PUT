(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{496:function(e,s,r){"use strict";r.r(s);var t=r(3),a=Object(t.a)({},(function(){var e=this,s=e.$createElement,r=e._self._c||s;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("p",[e._v("学校でプロキシを経由する必要があったりなかったり、、、"),r("br"),e._v("\nなので自身の使うDocker Desktop for Windowsをプロキシ環境下で使う際の設定を調べてみました。")]),e._v(" "),r("h2",{attrs:{id:"環境"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#環境"}},[e._v("#")]),e._v(" 環境")]),e._v(" "),r("ul",[r("li",[e._v("Windows10 Home Version 2004 OS Build 19041.630")]),e._v(" "),r("li",[e._v("Docker v19.03.13 ( WSL 2 backend )")])]),e._v(" "),r("h2",{attrs:{id:"_1imageのpush・pull時にプロキシを利用したい"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1imageのpush・pull時にプロキシを利用したい"}},[e._v("#")]),e._v(" ①imageのpush・pull時にプロキシを利用したい")]),e._v(" "),r("p",[r("code",[e._v("docker push")]),e._v("や"),r("code",[e._v("docker pull")]),e._v("Dockerfile内の"),r("code",[e._v("FROM <image:tag>")]),e._v("がうまく行かない場合は"),r("br"),e._v(" "),r("code",[e._v("setting->Resouces->PROXIES")]),e._v("からプロキシサーバーを指定してください。"),r("br"),e._v(" "),r("img",{attrs:{src:"/docs_img/docker_desktop_settng_proxy.png",alt:"Setting"}})]),e._v(" "),r("h2",{attrs:{id:"_2docker-build時にプロキシを利用したい"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2docker-build時にプロキシを利用したい"}},[e._v("#")]),e._v(" ②docker build時にプロキシを利用したい")]),e._v(" "),r("p",[r("code",[e._v("docker build")]),e._v("で行う"),r("code",[e._v("apt-get")]),e._v("や"),r("code",[e._v("npm install")]),e._v("等がうまく行かない場合は")]),e._v(" "),r("h3",{attrs:{id:"docker-17-07以降"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#docker-17-07以降"}},[e._v("#")]),e._v(" Docker 17.07以降")]),e._v(" "),r("p",[e._v("コンテナを起動するユーザーのホームディレクトリに"),r("code",[e._v(".docker/config.json")]),e._v("を作成、または編集します。")]),e._v(" "),r("div",{staticClass:"language-~/.docker/config.json line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('{\n "proxies":\n {\n   "default":\n   {\n     "httpProxy": <proxy-setting>,\n     "httpsProxy": <proxy-setting>,\n     "noProxy": <no-proxy-setting>\n   }\n }\n}\n')])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br")])]),r("p",[e._v("この設定を記述しておくと、プロキシを利用できます。")]),e._v(" "),r("h3",{attrs:{id:"docker-17-06以前"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#docker-17-06以前"}},[e._v("#")]),e._v(" Docker 17.06以前")]),e._v(" "),r("p",[e._v("ビルド用に一時的に使う環境変数を手動で設定します。"),r("br"),e._v("\ndockerでは")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("docker build --build-arg HTTP_PROXY=<proxy-setting> --build-arg HTTPS_PROXY=<proxy-setting>\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("とすることでプロキシが利用できます。"),r("br"),e._v("\n通常"),r("code",[e._v("--build-arg")]),e._v("で変数を指定したい場合、事前に"),r("code",[e._v("Dockerfile")]),e._v("の"),r("code",[e._v("ARG")]),e._v("に定義しておく必要がありますが、")]),e._v(" "),r("ul",[r("li",[e._v("HTTP_PROXY")]),e._v(" "),r("li",[e._v("http_proxy")]),e._v(" "),r("li",[e._v("HTTPS_PROXY")]),e._v(" "),r("li",[e._v("https_proxy")]),e._v(" "),r("li",[e._v("FTP_PROXY")]),e._v(" "),r("li",[e._v("ftp_proxy")]),e._v(" "),r("li",[e._v("NO_PROXY")]),e._v(" "),r("li",[e._v("no_proxy")])]),e._v(" "),r("p",[e._v("以上のプロキシ用環境変数は"),r("code",[e._v("ARG")]),e._v("で定義せずとも"),r("code",[e._v("--build-arg")]),e._v("で使用できる"),r("strong",[e._v("事前定義変数")]),e._v("です。"),r("br"),e._v("\nまた、これらの変数はビルドの履歴を出力する"),r("code",[e._v("docker history")]),e._v("から除外されます。")]),e._v(" "),r("blockquote",[r("p",[e._v("※以上の変数をARGに再定義した場合、"),r("code",[e._v("docker history")]),e._v("で除外されないので注意が必要です。")])]),e._v(" "),r("p",[e._v("docker-composeでは")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("dcoker-compose --build-arg HTTP_PROXY=<proxy-setting> --build-arg HTTPS_PROXY=<proxy-setting>\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("とします。"),r("br"),e._v("\nまた、"),r("code",[e._v("docker-compose.yml")]),e._v("の"),r("code",[e._v("args")]),e._v("に")]),e._v(" "),r("div",{staticClass:"language-docker-compose.yml line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("build:\n  context: <Dockerfile-Path>\n  args:\n    - HTTP_PROXY=<proxy-seting>\n    - HTTPS_PROXY=<proxy-setting>\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br")])]),r("p",[e._v("と書くこともできます。")]),e._v(" "),r("h2",{attrs:{id:"_3コンテナ内からプロキシを利用したい"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3コンテナ内からプロキシを利用したい"}},[e._v("#")]),e._v(" ③コンテナ内からプロキシを利用したい")]),e._v(" "),r("p",[e._v("コンテナ内から行う"),r("code",[e._v("npm install")]),e._v("等がうまく行かない場合は")]),e._v(" "),r("h3",{attrs:{id:"docker-17-07以降-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#docker-17-07以降-2"}},[e._v("#")]),e._v(" Docker 17.07以降")]),e._v(" "),r("p",[r("code",[e._v("➁")]),e._v("と同様の設定を記述した上でコンテナを作成または開始すると、コンテナ内で利用できます。")]),e._v(" "),r("h3",{attrs:{id:"docker-17-06以前-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#docker-17-06以前-2"}},[e._v("#")]),e._v(" Docker 17.06以前")]),e._v(" "),r("p",[e._v("コンテナ内で扱う環境変数を手動で設定します。"),r("br"),e._v(" "),r("code",[e._v("Dockerfile")]),e._v("から設定する場合は")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("ENV HTTP_PROXY=<proxy-setting>\nENV HTTPS_PROXY=<proxy-setting>\n.\n..\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br")])]),r("p",[r("code",[e._v("docker-compose.yml")]),e._v("の場合は")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("environment:\n  - HTTP_PROXY=<proxy-setting>\n  - HTTPS_PROXY=<proxy-setting>\n.\n..\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br")])]),r("p",[e._v("と記述していき、")]),e._v(" "),r("p",[e._v("docker CLIから指定したい場合は")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("dcoker run --env HTTP_PROXY=<proxy-setting>\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("docker-compose CLIから指定したい場合は")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("dcoker-compose run --env HTTP_PROXY=<proxy-setting>\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("と入力します。")]),e._v(" "),r("blockquote",[r("p",[e._v("※"),r("code",[e._v("config.json")]),e._v("に設定する場合とは違い"),r("code",[e._v("ENV")]),e._v("はコンテナ・イメージそのものに環境変数が展開されるため、"),r("code",[e._v("ENV")]),e._v("で指定したコンテナ・イメージを共有するのには注意が必要です。\nできる限り"),r("code",[e._v("config.json")]),e._v("に設定するようにしましょう`")])]),e._v(" "),r("h2",{attrs:{id:"ホストの環境変数が使える"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ホストの環境変数が使える"}},[e._v("#")]),e._v(" ホストの環境変数が使える？")]),e._v(" "),r("p",[e._v("自分の環境で試したところ、ホストに"),r("code",[e._v("$ENV:http_proxy...")]),e._v("が設定されている場合、"),r("code",[e._v("➁")]),e._v("、"),r("code",[e._v("➂")]),e._v("のケースでプロキシが利用できることが分かりました。"),r("br"),e._v("\nこれに関しての記載が公式ドキュメントに見つからなかったため、詳細を知っている方がいればぜひ教えてほしいです。")]),e._v(" "),r("h2",{attrs:{id:"参考リンク"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考リンク"}},[e._v("#")]),e._v(" 参考リンク")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://docs.docker.com/network/proxy/",target:"_blank",rel:"noopener noreferrer"}},[r("strong",[e._v("Configure Docker to use a proxy server")]),r("OutboundLink")],1),r("br"),e._v(" "),r("a",{attrs:{href:"https://docs.docker.com/docker-for-windows/",target:"_blank",rel:"noopener noreferrer"}},[r("strong",[e._v("Docker Desktop for Windows user manual")]),r("OutboundLink")],1),r("br"),e._v(" "),r("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/",target:"_blank",rel:"noopener noreferrer"}},[r("strong",[e._v("Dockerfile reference")]),r("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=a.exports}}]);